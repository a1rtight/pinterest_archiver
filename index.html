<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pinterest Archiver - Install</title>
  <meta name="description" content="Open source image downloader for Pinterest. Save boards your downloads instantly, no strings attached.">
  <meta property="og:title" content="Pinterest Archiver">
  <meta property="og:description" content="Open source image downloader for Pinterest. Save boards your downloads instantly, no strings attached.">
  <meta property="og:image" content="https://a1rtight.github.io/pinterest_archiver/img/og.webp">
  <meta property="og:url" content="https://a1rtight.github.io/pinterest_archiver/">
  <meta property="og:type" content="website">
  <meta name="twitter:card" content="summary_large_image">
  <link rel="icon" type="image/png" sizes="32x32" href="img/fav.png">
  <link rel="icon" type="image/png" sizes="16x16" href="img/fav.png">
  <link rel="shortcut icon" type="image/png" href="img/fav.png">
  <link rel="apple-touch-icon" href="img/fav.png">
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 0;
      line-height: 1.3rem;
      color: #000;
      font-size: 1rem;
      display: grid;
      grid-template-columns: .7fr 3.4fr 3.4fr .7fr;
      gap: 0 .4rem;
      min-height: calc(100dvh - 4rem);
      margin: 2rem 0;
      padding-bottom: 3rem;
    }
    .content {
      grid-column: 3;
      display: flex;
      flex-direction: column;
      max-width: 36rem;
    }
    .feature-image {
      position: fixed;
      left: 8.5%;
      top: 50%;
      transform: translateY(-50%);
      width: 33%;
      max-width: 600px;
    }
    p {
      margin: 0;
    }
    h1, h3 {
      font-size: 1rem;
      line-height: 1.3rem;
      border-top: 1px solid #E4E4E4;
      padding-top: .4rem;
      margin: 1rem 0 .5rem 0;
    }
    h1 {
      margin-top: 0;
    }
    .subtitle {
      margin-bottom: 1.6rem;
    }
    .bookmarklet-link {
      display: inline-flex;
      align-items: baseline;
      cursor: grab;
      color: #e60023;
      text-decoration: none;
    }
    .bookmarklet-dot {
      width: 14px;
      height: 14px;
      background: #e60023;
      border-radius: 50%;
      margin-right: 6px;
      position: relative;
      top: 2px;
    }
    ol {
      padding-left: 20px;
      margin: 0;
    }
    ol li {
      margin-bottom: .6rem;
    }
    code {
      background: #eee;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 1rem;
    }
    figure {
      margin: 0;
      font-size: 14px;
      color: #000;
    }
    .note {
      margin-top: auto;
      background: #FFF8E6;
      padding: 20px;
      border-radius: 8px;
    }
    .install-list {
      list-style: none;
      padding-left: 0;
      margin-bottom: 1.6rem;
    }
    .install-list li:last-child {
      margin-bottom: 0;
    }
    ol:not(.install-list) {
      margin-bottom: 1.6rem;
      margin-left: 1rem;
    }
    .author {
      display: flex;
      align-items: center;
      background: #fff;
      padding: 1rem 0 1.8rem 0;
      position: fixed;
      bottom: 0;
      left: 50%;
      width: 36rem;
    }
    .author-label {
      font-size: 14px;
      color: #111;
      margin-right: 8px;
    }
    .author-dot {
      width: 14px;
      height: 14px;
      background: #FF9D00;
      border-radius: 50%;
      margin-right: 6px;
    }
    .author-name {
      font-size: 14px;
      color: #111;
      font-weight: 400;
      text-decoration: none;
      cursor: pointer;
      transition: opacity .3s cubic-bezier(.4,0,.2,1);
    }
    .author-name:hover {
      opacity: .4;
    }
    .author-divider {
      color: #888;
      position: relative;
      top: -1px;
    }
    @media (min-width: 1800px) {
      body {
        grid-template-columns: 1fr 800px 800px 1fr;
      }
      .feature-image {
        left: calc(50vw - 800px);
        width: 640px;
        max-width: none;
      }
    }
    @media (max-width: 1200px) {
      body {
        grid-template-columns: .3fr 3.4fr 3.4fr .3fr;
      }
    }
    @media (max-width: 950px) {
      .feature-image {
        left: 4%;
        width: 42%;
        max-width: none;
      }
    }
    @media (max-width: 680px) {
      body {
        grid-template-columns: 1fr;
        padding: 0 1rem;
        margin-bottom: 0;
      }
      .content {
        grid-column: 1;
        max-width: 450px;
      }
      .feature-image {
        position: static;
        transform: none;
        width: 100%;
        max-width: none;
        margin: 1.6rem 0;
      }
      ol:not(.install-list) {
        margin-bottom: 8rem;
      }
      .author {
        left: 1rem;
        width: calc(100% - 2rem);
        padding: 1rem 0;
      }
      .note {
        margin-bottom: 5rem;
      }
    }
  </style>
</head>
<body>
  <div class="content">
    <h1>Pinterest Archiver (desktop)</h1>
    <p class="subtitle">Save high res images from your boards to your downloads folder.</p>

    <h3>Installation</h3>
    <ol class="install-list">
      <li>Show your bookmarks bar (Cmd+Shift+B on Mac, Ctrl+Shift+B on Windows)</li>
      <li>Drag <a class="bookmarklet-link" id="bookmarklet-link" href="#"><span class="bookmarklet-dot"></span>Pinterest Archiver</a> to your bookmarks bar</li>
    </ol>

    <video class="feature-image" autoplay muted playsinline loop preload="auto">
      <source src="tester.mp4" type="video/mp4">
    </video>

    <h3>How to use</h3>
    <ol>
      <li>Go to any Pinterest board page</li>
      <li>Click "Pinterest Archiver" in bookmarks</li>
      <li>An overlay shows the board name and pin count</li>
      <li>For boards with 500+ pins, there is the option to download in increments of 2000 pins</li>
      <li>Clicking start will initiate the download and it will autocomplete when all available pins have been fetched</li>
      <li>Clicking pause and download will download the currently fetched pins and resume the fetching process when start is clicked</li>
    </ol>

    <figure class="note"><b>This tool isn't perfect</b> and works within Pinterest's limits. Hard refreshing a board can yield better results if pins are initially missed. Downloading larger boards (6k+ pins) will take some time.</figure>

    <figure class="author">
      <span class="author-label">Author:</span>
      <span class="author-dot"></span>
      <a href="https://www.jbrandford.com" target="_blank" class="author-name">J.Brandford</a>&ensp;<span class="author-divider">|</span>&ensp;<a href="https://uk.pinterest.com/a1rtight/" target="_blank" class="author-name">↗ Pinterest</a>
    </figure>
  </div>

  <script>
    var bookmarkletCode = "javascript:!function(){var e=document.getElementById(\"pa-overlay\");if(e)e.remove();else{var t=0,n=\"\",o=[],a=null,i=!1,l=!1,r=!1,s=[],c=new Set,d=[],p=0,u=!1,g=0,f=\"\",m=0,h=0,v=!0,w=!1,b=new Set,y=0;window.paResumeState&&(console.log(\"[PA] Restoring resume state from window.paResumeState\"),m=window.paResumeState.chunkNumber||0,y=window.paResumeState.lastChunkBoundaryY||0,g=window.paResumeState.fileCounter||0,h=window.paResumeState.totalDownloadedAllChunks||0,window.paResumeState.permanentlyDownloadedIds&&(b=new Set(window.paResumeState.permanentlyDownloadedIds),c=new Set(window.paResumeState.permanentlyDownloadedIds)),console.log(\"[PA] Restored: chunk=\"+m+\", boundary=\"+y+\", fileCounter=\"+g+\", pins=\"+b.size));var A=location.href,x=null,E=document.createElement(\"style\");E.id=\"pa-styles\",E.textContent='#pa-overlay{position:fixed;top:20px;right:20px;width:24rem;background:#fff;border-radius:12px;box-shadow:0 4px 24px rgba(0,0,0,.30);z-index:999999;font-family:inherit;color:#111;max-height:90vh;overflow:hidden}#pa-overlay *{box-sizing:border-box}.pa-c{padding:1.25rem;overflow-y:auto}.pa-header{display:flex;justify-content:space-between;align-items:center;padding-bottom:.9rem;margin-bottom:.8rem;border-bottom:1px solid #efefef}.pa-header h2{margin:0;font-size:16px;font-weight:400}.pa-x{background:none;border:none;cursor:pointer;color:#767676;padding:0;display:flex;align-items:center;justify-content:center}.pa-n{font-size:1.8rem;font-weight:700;margin:0;padding-top:1.95rem;padding-bottom:.4rem;line-height:1.2}.pa-pin-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.pa-p{font-size:14px;color:#767676}.pa-scan{background:none;border:none;font-size:14px;color:#767676;cursor:pointer;padding:0}.pa-scan:hover{text-decoration:underline}#pa-sections-panel{transition:height 0.25s ease;overflow:hidden}.pa-sec-group{margin-bottom:16px;border-top:1px solid #E4E4E4;padding-top:.5rem;padding-bottom:1.26rem}.pa-sec-header{display:flex;align-items:center;margin-bottom:12px}.pa-sec-header input{width:16px;height:16px;margin:0 10px 0 0;cursor:pointer;-webkit-appearance:none;appearance:none;border-radius:50%;background:#E6E6E6;border:none;position:relative}.pa-sec-header input:checked{background:#111}.pa-sec-header input:checked::after{content:\"\\\\2713\";color:#fff;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:10px;line-height:1}.pa-sec-label{font-size:15px;font-weight:400}.pa-sec-list{max-height:140px;overflow-y:auto;margin-left:26px}.pa-sec-item{display:flex;align-items:center;padding:6px 0}.pa-sec-item input{width:14px;height:14px;margin:0 10px 0 0;cursor:pointer;-webkit-appearance:none;appearance:none;border-radius:0;background:#E6E6E6;border:none;position:relative}.pa-sec-item input:checked{background:#111}.pa-sec-item input:checked::after{content:\"\\\\2713\";color:#fff;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:9px;line-height:1}.pa-sec-name{flex:1;font-size:14px;color:#111;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.pa-sec-pins{font-size:14px;color:#767676;margin-left:12px}.pa-main{display:flex;align-items:center;padding:.5rem 0 1.26rem 0;margin-bottom:20px;border-top:1px solid #E4E4E4}.pa-main input{width:16px;height:16px;margin:0 10px 0 0;cursor:pointer;-webkit-appearance:none;appearance:none;border-radius:50%;background:#E6E6E6;border:none;position:relative}.pa-main input:checked{background:#111}.pa-main input:checked::after{content:\"\\\\2713\";color:#fff;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:10px;line-height:1}.pa-main-label{font-size:15px;font-weight:400}.pa-main-pins{font-size:15px;color:#767676;margin-left:6px}.pa-btns{display:flex;gap:.2rem;margin-bottom:24px}.pa-btn{flex:1;height:2.4rem;padding:0 20px;border-radius:.6rem;font-size:15px;font-weight:400;cursor:pointer;border:none;transition:background-color .3s cubic-bezier(.4,0,.2,1);display:flex;align-items:center;justify-content:center}.pa-btn:disabled{opacity:.5;cursor:not-allowed}.pa-btn-start{background:#e60023;color:#fff}.pa-btn-start:hover{background:#f4737a}.pa-btn-downloading{background:#f4737a;color:#fff;cursor:default}.pa-btn-pause{background:#111;color:#fff}.pa-btn-done{background:#111;color:#fff;cursor:default}.pa-progress{margin-bottom:20px}.pa-progress-text{font-size:14px;color:#111;margin-bottom:8px}.pa-progress-bar{height:8px;background:#E6E6E6;border-radius:4px;overflow:hidden}.pa-progress-fill{height:100%;background:#000;width:0;transition:width .3s ease}.pa-author{display:flex;align-items:center;padding-top:17px;border-top:1px solid #efefef}.pa-author-label{font-size:14px;color:#111;margin-right:8px}.pa-author-dot{width:14px;height:14px;background:#f5a623;border-radius:50%;margin-right:6px}.pa-author-name{font-size:14px;color:#111;font-weight:400;cursor:pointer;transition:opacity .3s cubic-bezier(.4,0,.2,1)}.pa-author-name:hover{opacity:.4}.pa-m{display:none;padding:12px;background:#fff8e6;border-radius:8px;font-size:13px;margin-bottom:16px}.pa-m.on{display:block}@keyframes pa-spin{to{transform:rotate(360deg)}}.pa-spinner{display:inline-block;width:20px;height:20px;border:2px solid #efefef;border-top-color:#e60023;border-radius:50%;animation:pa-spin 1s linear infinite}.pa-loading{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 20px;color:#767676;font-size:13px}.pa-loading .pa-spinner{margin-bottom:12px}#pa-live-status{display:none;margin-bottom:16px}#pa-live-status.on{display:block}.pa-live{display:inline-block;width:8px;height:8px;background:#e60023;border-radius:50%;margin-right:8px;animation:pa-pulse .8s cubic-bezier(.4,0,.2,1) infinite}.pa-paused{background:#767676;animation:none}@keyframes pa-pulse{0%,100%{background:#e60023}50%{background:#f4737a}}',document.head.appendChild(E);var P=null,S=0,k=1.15,C=!1,I=0,U=null,B=new WeakMap,R=new WeakMap,O=!1,M=0,D=0;!async function(){var e=await q();f=n.replace(/[^a-zA-Z0-9]/g,\"_\");var a=document.createElement(\"div\");a.id=\"pa-overlay\";var A='<div class=\"pa-c\">';A+='<div class=\"pa-header\"><h2>Pinterest Archiver</h2><button class=\"pa-x\" id=\"pa-x\"><svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\"><path d=\"M18 6L6 18M6 6l12 12\"/></svg></button></div>',A+='<div class=\"pa-n\" id=\"pa-title\">'+F(e.n)+\"</div>\",A+='<div class=\"pa-pin-row\">',A+='<span class=\"pa-p\" id=\"pa-pincount\">~'+e.t.toLocaleString()+\" pins\"+(e.section?\" (section)\":\"\")+\"</span>\",A+=\"</div>\",A+='<div id=\"pa-sections-panel\">',e.section||(A+='<div class=\"pa-loading\"><div class=\"pa-spinner\"></div><div>Loading sections...</div></div>'),A+=\"</div>\",e.t>2000&&(A+='<label class=\"pa-main\">',A+='<input type=\"checkbox\" id=\"pa-staged\" checked>',A+='<span class=\"pa-main-label\">Staged downloads</span>',A+='<span class=\"pa-main-pins\">(2k pins each)</span>',A+=\"</label>\"),A+='<div class=\"pa-btns\">',e.t>2000?(A+='<button class=\"pa-btn pa-btn-start\" id=\"pa-play\">Start</button>',A+='<button class=\"pa-btn pa-btn-pause\" id=\"pa-pause\" disabled>Pause & download</button>'):A+='<button class=\"pa-btn pa-btn-start\" id=\"pa-play\" style=\"flex:none;width:100%\">Start</button>',A+=\"</div>\",A+='<div id=\"pa-live-status\">',A+='<div style=\"font-size:13px;margin-bottom:4px\"><span class=\"pa-live\"></span><span id=\"pa-live-text\">Downloading...</span></div>',A+='<div style=\"font-size:12px;color:#767676\">',A+='<span id=\"pa-stat-downloaded\">0</span> downloaded · ',A+='<span id=\"pa-stat-queue\">0</span> queued · ',A+='<span id=\"pa-stat-active\">0</span> active</div>',A+=\"</div>\",A+='<div class=\"pa-progress\">',A+='<div class=\"pa-progress-text\"><span id=\"pa-dl-count\">0</span> / ~<span id=\"pa-dl-total\">'+e.t+\"</span> downloaded</div>\",A+='<div class=\"pa-progress-bar\"><div class=\"pa-progress-fill\" id=\"pa-dl-bar\"></div></div>',A+=\"</div>\",A+='<div class=\"pa-m\" id=\"pa-m\"></div>',A+='<div class=\"pa-author\">',A+='<span class=\"pa-author-label\">Author:</span>',A+='<span class=\"pa-author-dot\"></span>',A+='<a href=\"https://www.jbrandford.com\" target=\"_blank\" class=\"pa-author-name\" style=\"text-decoration:none;color:#111\">J.Brandford</a>',A+=\"</div>\",A+=\"</div>\",a.innerHTML=A,document.body.appendChild(a),document.getElementById(\"pa-x\").onclick=function(){u=!0,l=!0,W(),a.remove()},document.getElementById(\"pa-play\").onclick=function(){i||this.classList.contains(\"pa-btn-done\")||this.classList.contains(\"pa-btn-downloading\")||async function(){if(i)return;i=!0,l=!1,r=!1,u=!1,window.paSessionActive=!0,W(),C=!1,U=null;var e=document.getElementById(\"pa-play\"),n=document.getElementById(\"pa-pause\");e.textContent=\"Downloading\",e.classList.remove(\"pa-btn-start\"),e.classList.add(\"pa-btn-downloading\"),n&&(n.disabled=!1);var a=document.getElementById(\"pa-live-status\");a&&a.classList.add(\"on\");G(\"Starting...\",0);var p=[],A=!0;document.querySelectorAll(\".pa-section-cb\").forEach(function(e){if(\"true\"===e.dataset.main)A=e.checked;else if(e.checked&&e.dataset.idx){var t=parseInt(e.dataset.idx,10);o[t]&&p.push(o[t])}});var x=document.getElementById(\"pa-staged\");if(v=!!x&&x.checked,w=!1,console.warn(\"[PA] === DOWNLOAD CONFIG ===\"),console.warn(\"[PA] Staged download (2k chunks):\",v),console.warn(\"[PA] downloadMainBoard:\",A),console.warn(\"[PA] selectedSections:\",p.length,p.map(function(e){return e.name+\"(\"+e.pinCount+\")\"}).join(\", \")),console.warn(\"[PA] totalPins:\",t),console.log(\"[PA] Using BOARD ID VERIFICATION to filter recommendations\"),p.length>0)for(var E=0;E<p.length&&!l;E++){var P=p[E],B=\"https://www.pinterest.com\"+P.url;G(\"Scanning section \"+(E+1)+\"/\"+p.length+\": \"+P.name,E/p.length);for(var R=await ce(B,P.name,P.pinCount),N=f+\"/\"+P.name.replace(/[^a-zA-Z0-9 ]/g,\"\").trim(),T=0,q=s.length,_=0;_<R.urls.length;_++){var z=R.urls[_];c.has(z.pinId)||(c.add(z.pinId),T++,d.push({pinId:z.pinId,url:z.url,element:null,filePath:N+\"/\"+String(T).padStart(5,\"0\")+\".jpg\"}))}d.length>0&&!l&&(O=!1,ae(),await ie());var F=document.getElementById(\"pa-live-text\"),H=s.length-q;F&&(F.textContent='Section \"'+P.name+'\": '+H+\" saved\")}if(console.warn(\"[PA] === MAIN BOARD CHECK ===\"),console.warn(\"[PA] downloadMainBoard=\"+A+\", isPaused=\"+l),A&&!l){G(\"Downloading main board...\",0);var j=o.reduce(function(e,t){return e+(t.pinCount||0)},0);if(S=Math.max(0,t-j),C=!1,U=null,I=c.size,console.warn(\"[PA] Main board: expecting ~\"+S+\" pins (total: \"+t+\" - sections: \"+j+\")\"),console.warn(\"[PA] Pins already downloaded (sections): \"+I),0===S&&console.warn(\"[PA] WARNING: expectedPinCount is 0! Section pins >= total pins. Will try to collect anyway.\"),console.log(\"[PA] Will cap at \"+Math.ceil(S*k)+\" pins (with \"+Math.round(100*(k-1))+\"% buffer)\"),console.log(\"[PA][RESUME] === RESUME STATE ===\"),console.log(\"[PA][RESUME] chunkNumber: \"+m),console.log(\"[PA][RESUME] lastChunkBoundaryY: \"+Math.round(y)),console.log(\"[PA][RESUME] downloadedPinIds: \"+c.size),console.log(\"[PA][RESUME] permanentlyDownloadedIds: \"+b.size),console.log(\"[PA][RESUME] fileCounter: \"+g),console.log(\"[PA][RESUME] totalDownloadedAllChunks: \"+h),m>0&&(console.log(\"[PA][RESUME] Clearing stale DOM flags for fresh scan\"),document.querySelectorAll(\"[data-pa-queued], [data-pa-skipped]\").forEach(function(e){delete e.dataset.paQueued,delete e.dataset.paSkipped})),0===m)console.log(\"[PA] Starting fresh from top (chunk 0)\"),window.scrollTo(0,0);else{var V=Math.max(0,y-2*window.innerHeight);console.log(\"[PA][RESUME] Scrolling to Y=\"+Math.round(V)+\" (boundary \"+Math.round(y)+\" - 2vh buffer)\"),console.log(\"[PA][RESUME] Boundary filter active: only pins with Y > \"+Math.round(y)+\" will be queued\"),window.scrollTo(0,V)}await K(500),O=!0,ae(),await async function(){var e=0,n=d.length+s.length;D=window.scrollY,ne(),Q();for(;i&&!l&&!u;){var o=s.length-I;if(S>0&&o>=S){L(\"TARGET_REACHED: Downloaded \"+o+\"/\"+S+\" pins\");break}if(C){G(\"Reached recommendations section\",1),L(\"RECOMMENDATIONS_SECTION: Grid container filtering detected end of board pins\");break}window.scrollBy(0,1.5*window.innerHeight),await K(50);var a=ne();Q(),le();var r=d.length+s.length;if(r===n&&0===a){if(++e>30){console.log(\"[PA] Stuck detection triggered at \"+s.length+\" pins, trying recovery...\"),window.scrollTo(0,document.body.scrollHeight),await K(800),ne();var c=d.length+s.length;if(c===n&&(console.log(\"[PA] Strategy 1 failed, trying scroll reset...\"),window.scrollTo(0,Math.max(0,document.body.scrollHeight-10*window.innerHeight)),await K(500),window.scrollTo(0,document.body.scrollHeight),await K(800),ne(),c=d.length+s.length),c===n&&(console.log(\"[PA] Strategy 2 failed, trying extended scroll...\"),window.scrollBy(0,20*window.innerHeight),await K(1e3),ne(),c=d.length+s.length),c===n){if(o=s.length-I,S>0&&o>=S){L(\"STUCK_BUT_TARGET_REACHED: \"+o+\"/\"+S+\" after recovery attempts\");break}L(\"STUCK_ALL_STRATEGIES_FAILED: No new pins after 30 iterations + 3 recovery strategies. Board pins: \"+s.length+\", target: \"+S);break}console.log(\"[PA] Recovery successful, found \"+(c-n)+\" new pins\"),e=0,n=c}}else e=0,n=r;var p=document.getElementById(\"pa-live-text\");if(o=s.length-I,p){var g=h+s.length;p.textContent=\"Downloading... \"+g+\"/\"+t}if(S>0&&o>=S){L(\"TARGET_REACHED_END_OF_LOOP: \"+o+\"/\"+S);break}}i?l?L(\"LOOP_EXIT_PAUSED: isPaused became true\"):u&&L(\"LOOP_EXIT_SCROLL_ABORT: scrollAbort was set (likely pause button)\"):L(\"LOOP_EXIT_NOT_PLAYING: isPlaying became false\")}(),console.log(\"[PA] scrollLoop exited, stopping workers...\"),O=!1,d.length=0,console.log(\"[PA] Waiting for \"+M+\" workers to finish...\"),await ie(),console.log(\"[PA] All workers finished\"),G(\"Complete: \"+(s.length-I)+\" pins\",1)}if(!l&&!r){L(\"DOWNLOAD_COMPLETE: Saving final ZIP\"),await re();e=document.getElementById(\"pa-play\"),n=document.getElementById(\"pa-pause\");e.textContent=\"Done\",e.classList.remove(\"pa-btn-start\",\"pa-btn-downloading\"),e.classList.add(\"pa-btn-done\"),n&&(n.disabled=!0),window.paResumeState=null,window.paSessionActive=!1,Y()}}()};var x=document.getElementById(\"pa-pause\");x&&(x.onclick=function(){i&&async function(){r=!0,u=!0;var e=window.scrollY,n=s.length,o=d.length;console.log(\"[PA][PAUSE] === PAUSE INITIATED ===\"),console.log(\"[PA][PAUSE] Current scroll Y: \"+e),console.log(\"[PA][PAUSE] Files at pause click: \"+n),console.log(\"[PA][PAUSE] Queue items: \"+o),console.log(\"[PA][PAUSE] Active downloads: \"+p);var a=document.getElementById(\"pa-live-status\"),f=a?.querySelector(\".pa-live\");f&&f.classList.add(\"pa-paused\");var v=document.getElementById(\"pa-live-text\");G(\"Finishing downloads...\",.9);var w=0,A=150;for(;(p>0||d.length>0)&&w<A;){await K(100),w++;var x=d.length+p;v&&(v.textContent=\"Finishing: \"+x+\" remaining...\"),Q()}O=!1,l=!0,console.log(\"[PA][PAUSE] Queue drained: \"+(s.length-n)+\" pins added\"),console.log(\"[PA][PAUSE] Queue items remaining: \"+d.length),v&&(v.textContent=\"Finishing in-flight...\");for(;p>0;)await K(100),Q();var E=0;s.forEach(function(e){e.queuedAtY&&e.queuedAtY>E&&(E=e.queuedAtY)}),y=E,console.log(\"[PA][PAUSE] === BOUNDARY SET ===\"),console.log(\"[PA][PAUSE] lastChunkBoundaryY: \"+Math.round(y)),console.log(\"[PA][PAUSE] Files downloaded: \"+s.length);var P=new Set;s.forEach(function(e){e.pinId&&(P.add(e.pinId),b.add(e.pinId))});var S=[];c.forEach(function(e){P.has(e)||b.has(e)||S.push(e)}),c=new Set(b),P.forEach(function(e){c.add(e)});var k=0;document.querySelectorAll('[data-pa-queued=\"true\"]').forEach(function(e){e.dataset.paDownloaded||(delete e.dataset.paQueued,k++)});var I=0;s.forEach(function(e){e.fileNum&&e.fileNum>I&&(I=e.fileNum)});var B=g;g=I,console.log(\"[PA][PAUSE] --- After rebuild ---\"),console.log(\"[PA][PAUSE] Orphaned pins: \"+S.length),console.log(\"[PA][PAUSE] Cleared DOM elements: \"+k),console.log(\"[PA][PAUSE] fileCounter reset from \"+B+\" to \"+g),console.log(\"[PA][PAUSE] downloadedPinIds rebuilt: \"+c.size+\" pins\"),m++,await re(!0),h+=s.length,console.log(\"[PA][PAUSE] Chunk \"+m+\" saved: \"+s.length+\" pins, cumulative: \"+h),window.paResumeState={chunkNumber:m,lastChunkBoundaryY:y,fileCounter:g,totalDownloadedAllChunks:h,permanentlyDownloadedIds:Array.from(b)},console.log(\"[PA][PAUSE] Resume state saved to window.paResumeState\"),s=[],d=[],i=!1,r=!1,u=!1,C=!1,U=null;var R=document.getElementById(\"pa-play\"),M=document.getElementById(\"pa-pause\");R.textContent=\"Start\",R.classList.remove(\"pa-btn-downloading\"),R.classList.add(\"pa-btn-start\"),M&&(M.disabled=!0);a&&a.classList.remove(\"on\");f&&f.classList.remove(\"pa-paused\");Q(),G(\"Part \"+m+\" saved (\"+h+\"/\"+t+\"). Click Start to continue.\",1)}()}),e.section||function(t){var n=document.getElementById(\"pa-sections-panel\");if(n)if(e.section)n.innerHTML=\"\";else{var o=t.reduce(function(e,t){return e+(t.pinCount||0)},0),a=Math.max(0,e.t-o),i=\"\";t.length>0&&(i+='<div class=\"pa-sec-group\">',i+='<label class=\"pa-sec-header\">',i+='<input type=\"checkbox\" id=\"pa-select-all-sections\" checked>',i+='<span class=\"pa-sec-label\">Sections ('+t.length+\")</span>\",i+=\"</label>\",i+='<div class=\"pa-sec-list\">',t.forEach(function(e,t){i+='<label class=\"pa-sec-item\">',i+='<input type=\"checkbox\" class=\"pa-section-cb\" data-idx=\"'+t+'\" checked>',i+='<span class=\"pa-sec-name\">'+F(e.name)+\"</span>\",i+='<span class=\"pa-sec-pins\">'+e.pinCount+\" pins</span>\",i+=\"</label>\"}),i+=\"</div></div>\"),i+='<label class=\"pa-main\">',i+='<input type=\"checkbox\" class=\"pa-section-cb\" data-main=\"true\" checked>',i+='<span class=\"pa-main-label\">Main board</span>',i+='<span class=\"pa-main-pins\">('+a+\" pins)</span>\",i+=\"</label>\",n.innerHTML=i;var l=document.getElementById(\"pa-select-all-sections\");l&&(l.onchange=function(){document.querySelectorAll(\".pa-section-cb[data-idx]\").forEach(function(e){e.checked=l.checked})})}}(await z()),Y()}()}function L(e){var n=h+s.length;console.log(\"\\n========== [PA] DOWNLOAD STOPPED ==========\"),console.log(\"[PA] REASON: \"+e),console.log(\"[PA] --- Download Stats ---\"),console.log(\"[PA] Total downloaded (all chunks): \"+n),console.log(\"[PA] Current chunk files: \"+s.length),console.log(\"[PA] Chunk number: \"+m),console.log(\"[PA] Target pin count: \"+t),console.log(\"[PA] Expected main board pins: \"+(void 0!==S?S:\"N/A\")),console.log(\"[PA] --- Queue State ---\"),console.log(\"[PA] Queue length: \"+d.length),console.log(\"[PA] Active downloads: \"+p),console.log(\"[PA] Workers running: \"+(void 0!==M?M:\"N/A\")),console.log(\"[PA] --- Flags ---\"),console.log(\"[PA] isPlaying: \"+i),console.log(\"[PA] isPaused: \"+l),console.log(\"[PA] pauseRequested: \"+r),console.log(\"[PA] scrollAbort: \"+u),console.log(\"[PA] isScrolling: \"+(void 0!==O?O:\"N/A\")),console.log(\"[PA] reachedRecommendations: \"+(void 0!==C?C:\"N/A\")),console.log(\"[PA] --- Scroll Position ---\"),console.log(\"[PA] Current scroll Y: \"+window.scrollY),console.log(\"[PA] Document height: \"+document.body.scrollHeight),console.log(\"[PA] Viewport height: \"+window.innerHeight),console.log(\"[PA] Last chunk boundary Y: \"+y),console.log(\"[PA] --- DOM State ---\"),console.log(\"[PA] Pins in DOM: \"+document.querySelectorAll('[data-test-id=\"pin\"]').length),console.log(\"[PA] Queued elements: \"+document.querySelectorAll(\"[data-pa-queued]\").length),console.log(\"[PA] Downloaded elements: \"+document.querySelectorAll(\"[data-pa-downloaded]\").length),console.log(\"[PA] Skipped elements: \"+document.querySelectorAll(\"[data-pa-skipped]\").length),console.log(\"[PA] downloadedPinIds size: \"+c.size),console.log(\"[PA] permanentlyDownloadedIds size: \"+b.size),console.log(\"============================================\\n\")}function N(e){for(var t=[],n=[],o=0,a=0;a<e.length;a++){var i=e[a],l=(new TextEncoder).encode(i.name),r=new Uint8Array(i.data),s=new Uint8Array(30+l.length+r.length),c=new DataView(s.buffer);c.setUint32(0,67324752,!0),c.setUint16(4,20,!0),c.setUint16(6,0,!0),c.setUint16(8,0,!0),c.setUint16(10,0,!0),c.setUint16(12,0,!0),c.setUint32(14,i.crc,!0),c.setUint32(18,r.length,!0),c.setUint32(22,r.length,!0),c.setUint16(26,l.length,!0),c.setUint16(28,0,!0),s.set(l,30),s.set(r,30+l.length),t.push(s);var d=new Uint8Array(46+l.length),p=new DataView(d.buffer);p.setUint32(0,33639248,!0),p.setUint16(4,20,!0),p.setUint16(6,20,!0),p.setUint16(8,0,!0),p.setUint16(10,0,!0),p.setUint16(12,0,!0),p.setUint16(14,0,!0),p.setUint32(16,i.crc,!0),p.setUint32(20,r.length,!0),p.setUint32(24,r.length,!0),p.setUint16(28,l.length,!0),p.setUint16(30,0,!0),p.setUint16(32,0,!0),p.setUint16(34,0,!0),p.setUint16(36,0,!0),p.setUint32(38,0,!0),p.setUint32(42,o,!0),d.set(l,46),n.push(d),o+=s.length}var u=n.reduce(function(e,t){return e+t.length},0),g=new Uint8Array(22),f=new DataView(g.buffer);f.setUint32(0,101010256,!0),f.setUint16(4,0,!0),f.setUint16(6,0,!0),f.setUint16(8,e.length,!0),f.setUint16(10,e.length,!0),f.setUint32(12,u,!0),f.setUint32(16,o,!0),f.setUint16(20,0,!0);for(var m=new Uint8Array(o+u+22),h=0,v=0;v<t.length;v++)m.set(t[v],h),h+=t[v].length;for(var w=0;w<n.length;w++)m.set(n[w],h),h+=n[w].length;return m.set(g,h),m}function T(e){for(var t=function(){if(P)return P;P=[];for(var e=0;e<256;e++){for(var t=e,n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;P[e]=t}return P}(),n=4294967295,o=0;o<e.length;o++)n=t[255&(n^e[o])]^n>>>8;return(4294967295^n)>>>0}async function q(){for(var e=['[data-test-id=\"board-name\"]',\"h1\",'[role=\"heading\"]'],o=0;o<e.length;o++){var i=document.querySelector(e[o]);if(i&&i.textContent.trim()){n=i.textContent.trim();break}}var l=await async function(){var e=location.pathname.split(\"/\").filter(Boolean);if(e.length<3)return null;var t=e[0],n=e[1],o=e[2];if(-1!==[\"pins\",\"more_ideas\",\"followers\",\"activity\",\"settings\",\"edit\",\"invite\",\"organize\"].indexOf(o))return null;function a(e,t,n,o){for(var a=0;a<e.length;a++)try{var i=e[a].textContent||e[a],l=JSON.parse(i);if(l.resource&&\"BoardSectionResource\"===l.resource.name){var r=l.resource.options||{};if(r.username===t&&r.board_slug===n&&r.section_slug===o){var s=l.resource_response&&l.resource_response.data;if(s&&\"board_section\"===s.type&&\"number\"==typeof s.pin_count)return s.pin_count}}}catch(e){}return null}var i=a(document.querySelectorAll('script[data-test-id=\"resource-response-data\"]'),t,n,o);if(null!==i)return console.log(\"[PA] Found section pin count from DOM: \"+i),i;console.log(\"[PA] DOM data stale, fetching fresh page data...\");try{var l=await fetch(location.href),r=(await l.text()).match(/<script[^>]*data-test-id=\"resource-response-data\"[^>]*>([^<]+)<\\/script>/g);if(r){var s=r.map(function(e){var t=e.match(/>([^<]+)</);return t?t[1]:\"\"});if(null!==(i=a(s,t,n,o)))return console.log(\"[PA] Found section pin count from fetched HTML: \"+i),i}}catch(e){console.log(\"[PA] Failed to fetch fresh page data:\",e)}return null}();if(null!==l)t=l;else{var r=document.querySelector('[data-test-id=\"pin-count\"]');if(r){var s=r.textContent.match(/[\\d,]+/);s&&(t=parseInt(s[0].replace(/,/g,\"\"),10))}t||(t=document.querySelectorAll('[data-test-id=\"pin\"]').length||0)}if(!n){var c=location.pathname.split(\"/\").filter(Boolean);n=c[c.length-1]||\"board\"}var d=location.pathname.split(\"/\").filter(Boolean);if(d.length>=3){var p=d[2];-1===[\"pins\",\"more_ideas\",\"followers\",\"activity\",\"settings\",\"edit\",\"invite\",\"organize\"].indexOf(p)&&(a=decodeURIComponent(p).replace(/-/g,\" \"))}return{n:n,t:t,section:a}}function _(){o=[];var e=location.pathname.split(\"/\").filter(Boolean);if(e.length<2)return o;var t=\"/\"+e[0]+\"/\"+e[1],n=new Map,a=[\"pins\",\"more_ideas\",\"followers\",\"activity\",\"settings\",\"edit\",\"invite\",\"organize\",\"organise\",\"collaborators\",\"invites\",\"see\",\"see-pins\",\"see_pins\",\"ideas\",\"search\",\"notifications\",\"messages\",\"create\",\"board\",\"pin\",\"user\",\"about\",\"terms\",\"privacy\",\"help\",\"contact\"];function i(e){return!!e&&(-1===a.indexOf(e.toLowerCase())&&(\"_\"!==e.charAt(0)&&!e.match(/^[\\d]+$/)))}try{document.querySelectorAll(\"script\").forEach(function(e){var t=e.textContent||\"\";if(!(t.length<100)){for(var o,a=/\"slug\"\\s*:\\s*\"([^\"]+)\"[^}]*?\"__typename\"\\s*:\\s*\"BoardSection\"/g;null!==(o=a.exec(t));){if(i(p=o[1])){var l=Math.max(0,o.index-300),r=Math.min(t.length,o.index+500),s=0;(g=(u=t.slice(l,r)).match(/\"pin_count\"\\s*:\\s*(\\d+)/))&&(s=parseInt(g[1],10));var c=decodeURIComponent(p).replace(/-/g,\" \");(f=u.match(/\"title\"\\s*:\\s*\"([^\"]+)\"/))&&(c=f[1]),n.has(p)||(n.set(p,{name:c,pinCount:s}),console.log('[PA] Found section from JSON: \"'+c+'\" ('+s+\" pins)\"))}}for(var d=/\"__typename\"\\s*:\\s*\"BoardSection\"[^}]*?\"slug\"\\s*:\\s*\"([^\"]+)\"/g;null!==(o=d.exec(t));){var p;if(i(p=o[1])&&!n.has(p)){var u,g;l=Math.max(0,o.index-300),r=Math.min(t.length,o.index+500),s=0;(g=(u=t.slice(l,r)).match(/\"pin_count\"\\s*:\\s*(\\d+)/))&&(s=parseInt(g[1],10));var f;c=decodeURIComponent(p).replace(/-/g,\" \");(f=u.match(/\"title\"\\s*:\\s*\"([^\"]+)\"/))&&(c=f[1]),n.set(p,{name:c,pinCount:s}),console.log('[PA] Found section from JSON (reverse): \"'+c+'\" ('+s+\" pins)\")}}}})}catch(e){}return document.querySelectorAll(\"a[href]\").forEach(function(e){var o=e.getAttribute(\"href\")||\"\";if(0===o.indexOf(t+\"/\")){var a=o.slice(t.length+1).split(\"/\")[0].split(\"?\")[0];if(a&&i(a)){var l=e.closest(\"[data-test-id]\")||e.parentElement?.parentElement?.parentElement;if(l){var r=(l.textContent||\"\").match(/(\\d+)\\s*(?:pins?|Pins?)/i);if(r){var s=parseInt(r[1],10),c=decodeURIComponent(a).replace(/-/g,\" \");n.has(a)||(n.set(a,{name:c,pinCount:s}),console.log('[PA] Found section from DOM: \"'+c+'\" ('+s+\" pins)\"))}}}}}),n.forEach(function(e,n){o.push({name:e.name,slug:n,url:t+\"/\"+n,pinCount:e.pinCount})}),o.sort(function(e,t){return e.name.localeCompare(t.name)}),console.log(\"[PA] Total sections found: \"+o.length),o}async function z(){_();for(var e=window.scrollY,t=0;t<=2500;t+=400)window.scrollTo(0,t),await K(300);return await K(800),window.scrollTo(0,e),await K(300),_(),o}function F(e){var t=document.createElement(\"div\");return t.textContent=e,t.innerHTML}async function H(){u=!0;var e=document.getElementById(\"pa-sections-panel\"),r=location.pathname.split(\"/\").filter(Boolean),v=r.length>=3&&-1===[\"pins\",\"more_ideas\",\"followers\",\"activity\",\"settings\",\"edit\",\"invite\",\"organize\"].indexOf(r[2]),w=v?r[2]:r[1]||\"\",y=decodeURIComponent(w).toLowerCase().replace(/[-\\s]/g,\"\"),A=document.querySelector(\"h1[title]\")||document.querySelector(\"h1\"),x=\"\",E=!1;if(A){var P=(x=A.getAttribute(\"title\")||A.textContent.trim()).toLowerCase().replace(/[-\\s]/g,\"\");P&&y&&(P===y||-1!==P.indexOf(y)||-1!==y.indexOf(P))&&(E=!0)}var S=document.getElementById(\"pa-title\");if(S&&(S.textContent=E?x:\"\"),(O=document.getElementById(\"pa-pincount\"))&&(O.textContent=\"Loading...\"),!E)var k=0,I=setInterval(function(){var e=document.querySelector(\"h1[title]\")||document.querySelector(\"h1\");if(e){var t=e.getAttribute(\"title\")||e.textContent.trim(),n=t.toLowerCase().replace(/[-\\s]/g,\"\");if(n&&y&&(n===y||-1!==n.indexOf(y)||-1!==y.indexOf(n))){var o=document.getElementById(\"pa-title\");o&&(o.textContent=t),clearInterval(I)}}++k>40&&clearInterval(I)},50);if(e){var B=e.offsetHeight;if(e.style.height=B+\"px\",v)requestAnimationFrame(function(){requestAnimationFrame(function(){e.style.height=\"0px\",setTimeout(function(){e.innerHTML=\"\",e.style.height=\"auto\"},250)})});else{e.innerHTML='<div class=\"pa-loading\"><div class=\"pa-spinner\"></div><div>Loading sections...</div></div>',e.style.height=B+\"px\";var R=e.scrollHeight;requestAnimationFrame(function(){requestAnimationFrame(function(){e.style.height=R+\"px\",setTimeout(function(){e.style.height=\"auto\"},250)})})}}o=[],a=null,t=0,n=\"\";var O,M=await q();(f=n.replace(/[^a-zA-Z0-9]/g,\"_\"),(O=document.getElementById(\"pa-pincount\"))&&(O.textContent=\"~\"+M.t.toLocaleString()+\" pins\"+(M.section?\" (section)\":\"\")),!v&&e)&&function(e,t){var n=document.getElementById(\"pa-sections-panel\");if(!n)return;if(t.section)return void(n.innerHTML=\"\");var o=e.reduce(function(e,t){return e+(t.pinCount||0)},0),a=Math.max(0,t.t-o),i=\"\";e.length>0&&(i+='<div class=\"pa-sec-group\">',i+='<label class=\"pa-sec-header\">',i+='<input type=\"checkbox\" id=\"pa-select-all-sections\" checked>',i+='<span class=\"pa-sec-label\">Sections ('+e.length+\")</span>\",i+=\"</label>\",i+='<div class=\"pa-sec-list\">',e.forEach(function(e,t){i+='<label class=\"pa-sec-item\">',i+='<input type=\"checkbox\" class=\"pa-section-cb\" data-idx=\"'+t+'\" checked>',i+='<span class=\"pa-sec-name\">'+F(e.name)+\"</span>\",i+='<span class=\"pa-sec-pins\">'+e.pinCount+\" pins</span>\",i+=\"</label>\"}),i+=\"</div></div>\");i+='<label class=\"pa-main\">',i+='<input type=\"checkbox\" class=\"pa-section-cb\" data-main=\"true\" checked>',i+='<span class=\"pa-main-label\">Main board</span>',i+='<span class=\"pa-main-pins\">('+a+\" pins)</span>\",i+=\"</label>\",n.innerHTML=i;var l=document.getElementById(\"pa-select-all-sections\");l&&(l.onchange=function(){document.querySelectorAll(\".pa-section-cb[data-idx]\").forEach(function(e){e.checked=l.checked})})}(await z(),M);i=!1,l=!1,u=!1,s=[],c=new Set,b=new Set,d=[],g=0,p=0,U=null,C=!1,m=0,h=0;var D=document.getElementById(\"pa-dl-count\");D&&(D.textContent=\"0\");var L=document.getElementById(\"pa-dl-bar\");L&&(L.style.width=\"0%\");var N=document.getElementById(\"pa-dl-total\");N&&(N.textContent=M.t);var T=document.getElementById(\"pa-play\"),_=document.getElementById(\"pa-pause\");T&&(T.disabled=!1,T.textContent=\"Start\"),_&&(_.disabled=!0);var H=document.getElementById(\"pa-live-status\");H&&H.classList.remove(\"on\");var Y=document.getElementById(\"pa-m\");Y&&Y.classList.remove(\"on\"),console.log(\"[PA] UI updated for: \"+location.pathname)}function Y(){x||(A=location.href,x=setInterval(function(){if(location.href!==A){if(console.log(\"[PA] URL changed: \"+A+\" -> \"+location.href),A=location.href,window.paSessionActive)return void console.log(\"[PA] Session active - NOT resetting state\");H()}},500))}function W(){x&&(clearInterval(x),x=null)}function G(e,t){var n=document.getElementById(\"pa-live-text\");n&&(n.textContent=e)}function j(e){var t=document.getElementById(\"pa-m\");t&&(t.classList.add(\"on\"),t.innerHTML=e)}function Q(){var e=document.getElementById(\"pa-stat-downloaded\"),n=document.getElementById(\"pa-stat-queue\"),o=document.getElementById(\"pa-stat-active\"),a=document.getElementById(\"pa-dl-count\"),i=document.getElementById(\"pa-dl-bar\"),l=h+s.length;e&&(e.textContent=l),n&&(n.textContent=d.length),o&&(o.textContent=p),a&&(a.textContent=l),i&&t>0&&(i.style.width=Math.min(100,l/t*100)+\"%\")}function K(e){return new Promise(function(t){setTimeout(t,e)})}function V(e){return e&&-1!==e.indexOf(\"pinimg.com\")?(e=e.replace(/\\\\u002F/g,\"/\").replace(/\\\\\\//g,\"/\")).replace(/\\/\\d+x\\d*\\//,\"/originals/\"):null}function J(e){return!(!e||-1===e.indexOf(\"pinimg.com\"))&&(-1===e.indexOf(\"/avatars/\")&&!/\\/(75x75|60x60|50x50|30x30|140x140)(_RS)?\\//.test(e))}function Z(e){var t=e.ownerDocument||document,n=t!==document,o=$(t);function a(e){return!!o&&(!!(o.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_FOLLOWING)&&!(e.getBoundingClientRect().top<300))}if(n){var i=function(e){if(R.has(e))return R.get(e);for(var t=e.querySelectorAll(\"h1, h2\"),n=0;n<t.length;n++){var o=t[n];if(!o.closest('[data-test-id=\"pin\"], [data-grid-item=\"true\"]')&&!o.closest('header, nav, [role=\"navigation\"]')){for(var a=!1,i=e.querySelectorAll('a[href*=\"/pin/\"]'),l=0;l<i.length;l++){var r=i[l];if(o.compareDocumentPosition(r)&Node.DOCUMENT_POSITION_FOLLOWING){a=!0;break}}if(a)return console.log(\"[PA] Found section divider h1/h2:\",(o.textContent||\"\").substring(0,50)),R.set(e,o),o}}return R.set(e,null),null}(t);if(i&&a(i))if(i.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_FOLLOWING)return console.log(\"[PA] Element is AFTER section divider (post-grid)\"),!0}for(var l=e,r=0;l&&r<12;){for(var s=l.previousElementSibling;s;){if(s.matches(\"h1, h2\")&&!s.closest('[data-test-id=\"pin\"], [data-grid-item=\"true\"]')&&a(s))return console.log(\"[PA] Found h1/h2 sibling divider (post-grid):\",(s.textContent||\"\").substring(0,40)),!0;var c=s.querySelector(\"h1, h2\");if(c&&!c.closest('[data-test-id=\"pin\"], [data-grid-item=\"true\"]')&&a(c))return console.log(\"[PA] Found h1/h2 in sibling (post-grid):\",(c.textContent||\"\").substring(0,40)),!0;s=s.previousElementSibling}l=l.parentElement,r++}return!1}function X(e,t){for(var n=e,o=0;n&&n!==t.body&&o<15&&(n=n.parentElement);){if(o++,n.querySelectorAll('[data-test-id=\"pin\"], [data-grid-item=\"true\"]').length>=3)return n}return null}function $(e){var t=e===document;if(t&&U){if(document.contains(U))return U;console.log(\"[PA] Grid container detached from DOM - re-detecting\"),U=null;var n=0;document.querySelectorAll('[data-pa-skipped=\"outside-grid\"]').forEach(function(e){delete e.dataset.paSkipped,n++}),n>0&&console.log(\"[PA] Cleared \"+n+\" outside-grid skip markers for re-evaluation\")}if(!t&&B.has(e)){var a=B.get(e);if(e.contains(a))return a;console.log(\"[PA] Iframe grid container detached - re-detecting\"),B.delete(e)}var i=null;if(t&&o.length>0){console.log(\"[PA] Board has \"+o.length+\" sections - looking for pins grid (not sections grid)\");var l=e.querySelectorAll('[data-test-id=\"pin\"], [data-grid-item=\"true\"]'),r=new Map;l.forEach(function(t){if(t.querySelector('a[href*=\"/pin/\"]')){var n=X(t,e);n&&r.set(n,(r.get(n)||0)+1)}});var s=0;if(r.forEach(function(e,t){e>s&&(s=e,i=t)}),i&&(console.log(\"[PA] Found main pins grid with \"+s+\" pins\"),s<10))return console.log(\"[PA] Grid has few pins - will re-detect next scan (not caching)\"),i}else{var c=e.querySelector('[data-test-id=\"pin\"], [data-grid-item=\"true\"]');c&&(i=X(c,e))}return i?(t?U=i:B.set(e,i),i):(console.log(\"[PA] WARNING: Could not determine grid container\"),null)}function ee(e){var t=$(e.ownerDocument||document);return!t||t.contains(e)}async function te(e,t){try{var n=await fetch(e);if(!n.ok)throw new Error;return await n.arrayBuffer()}catch(n){if(\"jpg\"===t||!t)try{var o=await fetch(e.replace(\"/originals/\",\"/736x/\"));if(!o.ok)throw new Error;return await o.arrayBuffer()}catch(e){return null}return null}}function ne(){var e=0,t=window.innerHeight,n=document.querySelectorAll('[data-test-id=\"pin\"], [data-grid-item=\"true\"]');return Array.from(n).sort(function(e,t){return e.getBoundingClientRect().top-t.getBoundingClientRect().top}).forEach(function(n){n.dataset.paQueued&&!n.dataset.paDownloaded&&((i=n.querySelector('a[href*=\"/pin/\"]'))&&(l=i.href.match(/\\/pin\\/([^\\/]+)/))&&!c.has(l[1])&&delete n.dataset.paQueued);if(!(n.dataset.paQueued||n.dataset.paDownloaded||n.dataset.paSkipped||n.closest(\"header, nav\"))){var o=n.getBoundingClientRect(),a=o.top+window.scrollY;if(!(o.top>3*t||y>0&&a<=y))if(ee(n)){if(!C&&Z(n)&&(C=!0,console.log(\"[PA] Entered recommendations section (h1/h2 detected)\")),C)return n.dataset.paSkipped=\"recommendation\",void 0;var i,l;if(i=n.querySelector('a[href*=\"/pin/\"]'))if(l=i.href.match(/\\/pin\\/([^\\/]+)/)){var r=l[1];if(!c.has(r)){var s=n.querySelector('img[src*=\"pinimg.com\"]');if(s||(s=n.querySelector('img[srcset*=\"pinimg.com\"]')),s){var p=s.src||(s.srcset?s.srcset.split(\" \")[0]:null);if(p&&J(p)){var u=V(p);u&&(c.add(r),n.dataset.paQueued=\"true\",g++,d.push({pinId:r,url:u,element:n,fileNum:g,queuedAtY:a}),e++)}}}}}else n.dataset.paSkipped=\"outside-grid\"}}),e}async function oe(){for(M++;i&&!l;){for(;w&&i&&!l;)await K(50);if(S>0&&I>=0){var e=s.length-I;if(e>=S){console.log(\"[PA][WORKER] Exiting: target reached (\"+e+\"/\"+S+\")\");break}}if(0!==d.length){var t=d.shift();if(t){p++,Q();var n=await te(t.url);if(n){if(s.push({name:t.filePath||f+\"/\"+String(t.fileNum).padStart(5,\"0\")+\".jpg\",data:n,crc:T(new Uint8Array(n)),pinId:t.pinId,fileNum:t.fileNum,queuedAtY:t.queuedAtY||0}),t.pinId,t.element)t.element.dataset.paDownloaded=\"true\",t.element.style.opacity=\"0.3\",t.element.getBoundingClientRect().bottom<2*-window.innerHeight&&t.element.remove()}else t.pinId&&c.delete(t.pinId),t.element&&(delete t.element.dataset.paQueued,t.element.style.opacity=\"\"),console.log(\"[PA] Fetch failed for pin \"+t.pinId+\", unclaimed for retry\");p--,Q(),v&&s.length>=2e3&&!w&&await se()}}else{if(!O){console.log(\"[PA][WORKER] Exiting: queue empty and scrolling stopped\");break}await K(10)}}i?l&&console.log(\"[PA][WORKER] Exiting: isPaused=true\"):console.log(\"[PA][WORKER] Exiting: isPlaying=false\"),M--}function ae(){for(var e=0;e<10;e++)oe()}async function ie(){for(;M>0;){if(S>0&&I>=0)if(s.length-I>=S)break;await K(50),Q()}d.length=0}function le(){var e=window.scrollY;if(!(e-D<1e3)){D=e;var t=0,n=3*-window.innerHeight;document.querySelectorAll('[data-pa-downloaded=\"true\"]').forEach(function(e){e.getBoundingClientRect().bottom<n&&(e.remove(),t++)}),document.querySelectorAll(\"[data-pa-skipped]\").forEach(function(e){e.getBoundingClientRect().bottom<n&&(e.remove(),t++)}),t>0&&console.log(\"[PA] Cleaned up \"+t+\" old elements (keeping 3vh buffer)\")}}async function re(e){if(0===s.length)return G(\"No pins to save\"),void j(\"<b>No pins collected.</b> Try scrolling the page first.\");G(\"Creating zip...\"),s.sort(function(e,t){return e.name.localeCompare(t.name)});var t=s.map(function(e){return e.fileNum}).filter(Boolean);if(t.length>0){var n=Math.min.apply(null,t),o=Math.max.apply(null,t);if(console.log(\"[PA][CHUNK] Chunk \"+m+\" fileNum range: \"+n+\" - \"+o+\" (\"+t.length+\" files)\"),m>1&&window.lastChunkEndFileNum){var a=window.lastChunkEndFileNum+1;n!==a?(console.error(\"[PA][CHUNK] GAP DETECTED! Expected start: \"+a+\", actual: \"+n),console.error(\"[PA][CHUNK] Missing \"+(n-a)+\" pins between chunks!\")):console.log(\"[PA][CHUNK] Continuity OK: previous ended at \"+window.lastChunkEndFileNum)}window.lastChunkEndFileNum=o}var i=N(s),l=new Blob([i],{type:\"application/zip\"}),r=document.createElement(\"a\");r.href=URL.createObjectURL(l),r.download=e?f+\"_part\"+m+\"_\"+s.length+\"pins.zip\":f+\"_pins_\"+s.length+\".zip\",document.body.appendChild(r),r.click(),document.body.removeChild(r);try{var pa_u=localStorage.getItem(\"pa_uid\");pa_u||(pa_u=\"u_\"+Math.random().toString(36).substr(2,9),localStorage.setItem(\"pa_uid\",pa_u));fetch(\"https://script.google.com/macros/s/AKfycbwY6ucNutUD6QEUktm7lw39Tpb9rc1FJxFYjTUnHAK7rNtIlIzwIImDHEe3ORhZFtUY/exec?uid=\"+pa_u+\"&pins=\"+s.length+\"&sections=\"+o.length)}catch(e){}G(\"Saved! \"+s.length+\" images\"),j(\"<b>Saved!</b> \"+s.length+\" images downloaded.\");var c=document.getElementById(\"pa-live-status\");c&&!e&&c.classList.remove(\"on\")}async function se(){if(!w){w=!0,console.log(\"[PA] === AUTO-SAVE TRIGGERED ===\"),console.log(\"[PA] Files to save: \"+s.length);var e=document.getElementById(\"pa-live-text\");e&&(e.textContent=\"Auto-saving chunk \"+(m+1)+\"...\");for(var t=0;p>0;)await K(50),++t%20==0&&(console.log(\"[PA] Waiting for \"+p+\" in-flight downloads...\"),e&&(e.textContent=\"Finishing \"+p+\" in-flight...\"));m++,s.sort(function(e,t){return e.name.localeCompare(t.name)});var n=N(s),o=new Blob([n],{type:\"application/zip\"}),a=document.createElement(\"a\");a.href=URL.createObjectURL(o),a.download=f+\"_part\"+m+\"_\"+s.length+\"pins.zip\",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(a.href),console.log(\"[PA] Auto-saved chunk \"+m+\": \"+s.length+\" pins\"),h+=s.length,s.forEach(function(e){e.pinId&&b.add(e.pinId)}),console.log(\"[PA] Permanently downloaded IDs: \"+b.size);var i=0;s.forEach(function(e){e.fileNum&&e.fileNum>i&&(i=e.fileNum)}),g=i,s=[],Q(),e&&(e.textContent=\"Downloading... \"+h+\" saved\"),console.log(\"[PA] Auto-save complete, continuing download\"),w=!1}}async function ce(e,t,n){return new Promise(async function(o){G('Loading \"'+t+'\"...');var a=document.createElement(\"iframe\");a.style.cssText=\"position:fixed;top:0;left:0;width:100vw;height:100vh;opacity:0;pointer-events:none;z-index:-1\",a.src=e,document.body.appendChild(a);var i,l=!1;a.onload=function(){l=!0};for(var r=0;r<20&&!l;r++)await K(250);if(!l)return a.remove(),void o({urls:[],pinIds:new Set});await K(800);try{i=a.contentDocument||a.contentWindow.document}catch(e){return a.remove(),void o({urls:[],pinIds:new Set})}var s=new Map,c=a.contentWindow,d=n||50,p=!1,u=0;function g(){i.querySelectorAll('a[href*=\"/pin/\"]').forEach(function(e){var n=e.href.match(/\\/pin\\/([^\\/]+)/);if(n&&!s.has(n[1])){var o=n[1],a=e.closest('[data-test-id=\"pin\"]')||e.closest('[data-grid-item=\"true\"]');if(a||(a=e.parentElement&&e.parentElement.parentElement&&e.parentElement.parentElement.parentElement),a&&ee(a))if(!p&&Z(a)&&(p=!0,console.log('[PA] Section \"'+t+'\" reached recs (h1/h2 detected)')),p)u++;else{var i=a.querySelector('img[src*=\"pinimg.com\"]');if(i){var l=i.src;if(l&&J(l)){var r=V(l);r&&s.set(o,r)}}}}})}console.log('[PA] Section \"'+t+'\": target='+d+\" (grid filtering enabled)\"),G('Scanning \"'+t+'\" (expecting ~'+d+\")...\"),g();for(var f=0,m=0,h=0;h<150&&!p;h++){c.scrollBy(0,3*c.innerHeight),await K(120),g();var v=s.size;if(G('\"'+t+'\": '+v+\"/\"+d),v>=d)break;if(v===f){if(++m>8)break}else m=0,f=v}var w=p?\"recommendations detected\":s.size>=d?\"target reached\":\"no more pins\";console.log('[PA] Section \"'+t+'\" complete: '+s.size+\"/\"+d+\" pins (\"+w+\")\"+(u>0?\", skipped \"+u+\" recs\":\"\"));var b=[],y=new Set;s.forEach(function(e,t){e&&(b.push({url:e,pinId:t}),y.add(t))}),a.remove(),o({urls:b,pinIds:y})})}}();";

    // Set the bookmarklet href
    document.getElementById('bookmarklet-link').href = bookmarkletCode;

    // Prevent click from navigating (just for drag)
    document.getElementById('bookmarklet-link').addEventListener('click', function(e) {
      e.preventDefault();
      alert('Drag this button to your bookmarks bar to install it.');
    });
  </script>
</body>
</html>
<!-- v1.0.0 -->
